<ng-container *ngIf="loggedInUser.role.title == 'User'">
  <div class="row" *ngIf="courseStats">
    <div class="col-lg-12 col-sm-12">
      <div class="page-component">
        <div class="card">
          <div class="card-body p-0">
            <h5 class="component-title px-3 pt-3">Overall Progress</h5>
            <div class="row">
              <div class="col-3">
                <div class="progress-widget">
                  <div id="chart">
                    <apx-chart
                      [series]="chartOptions.series"
                      [chart]="chartOptions.chart"
                      [plotOptions]="chartOptions.plotOptions"
                      [labels]="chartOptions.labels"
                      [legend]="chartOptions.legend"
                      [stroke]="chartOptions.stroke"
                    ></apx-chart>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <div class="stat-widget mb-4">
                  <span class="stat-icon">
                    <i class="material-icons">playlist_play</i>
                  </span>
                  <div class="">
                    <h4 class="stat-value">
                      {{ courseStats.stats.courses.enrolled }}
                    </h4>
                    <h4 class="stat-title">Enrolled Courses</h4>
                  </div>
                </div>
                <div class="stat-widget">
                  <span class="stat-icon">
                    <i class="material-icons">replay</i>
                  </span>
                  <div class="">
                    <h4 class="stat-value">
                      {{ courseStats.stats.courses.inqueue }}
                    </h4>
                    <h4 class="stat-title">Courses Not Started</h4>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <div class="stat-widget mb-4">
                  <span class="stat-icon">
                    <i class="material-icons">access_time</i>
                  </span>
                  <div class="">
                    <h4 class="stat-value">
                      {{ courseStats.stats.courses.inprogress }}
                    </h4>
                    <h4 class="stat-title">Inprogress Courses</h4>
                  </div>
                </div>
                <div class="stat-widget">
                  <span class="stat-icon">
                    <i class="material-icons">check</i>
                  </span>
                  <div class="">
                    <h4 class="stat-value">
                      {{ courseStats.stats.courses.completed }}
                    </h4>
                    <h4 class="stat-title">Completed Courses</h4>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <img
                  src="/assets/images/stat-calculation.png"
                  height="162"
                  class="mt-3"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-8 col-sm-12">
      <div class="page-component">
        <h5 class="component-title">Resume Tasks</h5>
        <div class="card">
          <div class="card-body p-0">
            <div class="tasks-list-widget">
              <div
                class="task-row"
                *ngFor="let task of courseStats.tasks.upcoming"
              >
                <div class="task-info">
                  <h6 class="task-title">
                    <a
                      [routerLink]="[
                        '/courses',
                        task.courseId,
                        'task',
                        task.taskId
                      ]"
                      class="text-primary"
                      >{{ task.taskName }}</a
                    >
                  </h6>
                  <div class="task-attributes">
                    <div class="attrib">
                      <i class="material-icons">info_outline</i>
                      {{ task.taskType }}
                    </div>
                    <div class="attrib">
                      <i class="material-icons">access_time</i>
                      {{ task.estimatedTime }}
                    </div>
                    <div class="attrib">
                      <i class="material-icons">bookmark_border</i>
                      {{ task.courseName }}
                    </div>
                  </div>
                </div>
                <span class="task-icon-play material-icons"
                  >play_circle_outline</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-sm-12">
      <div class="page-component">
        <h5 class="component-title">Courses Completion</h5>
        <div class="card">
          <div class="card-body p-0">
            <div class="tasks-list-widget">
              <ng-container
                *ngFor="let course of courseStats.courses.completion"
              >
                <div
                  class="task-row"
                  *ngIf="
                    course.courseAssignments &&
                    course.courseAssignments.length > 0
                  "
                >
                  <div class="task-info">
                    <h6 class="task-title">
                      <a
                        [routerLink]="['/courses', course.id]"
                        class="text-primary"
                        >{{ course.title }}</a
                      >
                    </h6>
                    <div
                      class="task-attributes justify-content-between"
                      *ngFor="
                        let enrollment of course.courseAssignments[0]
                          .courseEnrollments
                      "
                    >
                      <div class="attrib">
                        <i class="material-icons">date_range</i>
                        <strong class="pr-1">Due Date: </strong>
                        {{ enrollment.completionDateOne || "Not Mentioned" }}
                      </div>
                      <div class="attrib">
                        <i class="material-icons">access_time</i>
                        <strong class="pr-1">Progress: </strong>
                        {{ enrollment.courseEnrollmentUsers[0].progress }}%
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-12">
      <ng-container *ngIf="loading">
        <div class="text-center loading-icon">
          <img src="/assets/images/loading.svg" />
        </div>
      </ng-container>
      <div class="page-component" *ngIf="!loading">
        <h5 class="component-title">My Courses</h5>

        <div class="row">
          <div
            class="col-lg-4 col-sm-12 col-xs-12"
            *ngFor="let course of courses"
          >
            <div class="card course">
              <div class="card-body course-body">
                <h6 class="course-attributes">
                  {{ course.code }} - {{ course.courseDepartment.title }}
                </h6>
                <div class="text-ellipsis-2">
                  <h5 class="course-title">
                    <a
                      [routerLink]="['/courses', course.id]"
                      class="text-primary"
                      >{{ course.title }}</a
                    >
                  </h5>
                </div>
                <!-- <div>
                    <a [routerLink]="['update', course.id]" *ngIf="permission.update">
                      <i class="material-icons fa-lg mr-2">edit</i></a>
                    <a href="#" data-toggle="modal" data-target="#deleteCourse" (click)="setCourse(course)"
                      *ngIf="permission.delete"><i class="material-icons fa-lg">delete</i></a>
                  </div> -->
                <div
                  class="course-stats"
                  *ngIf="loggedInUser.role.title == 'User'"
                >
                  <div class="course-stats-info">
                    <span class="course-tasks-count"
                      ><strong>{{ course.tasks.completed }}</strong> /
                      {{ course.tasks.total }}</span
                    >
                    <span class="course-tasks-nav-icon"
                      ><i class="material-icons">keyboard_arrow_right</i></span
                    >
                  </div>
                  <div class="course-progress progress">
                    <div
                      class="progress-bar"
                      role="progressbar"
                      [style]="'width: ' + course.progress + '%'"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
                <div class="buttons mt-3">
                  <a
                    *ngIf="loggedInUser.role.title == 'Client'"
                    [routerLink]="[
                      'courseAssignmentReport',
                      course.courseAssignmentId
                    ]"
                    class="btn btn-dark btn-sm"
                    >View Report</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="loggedInUser.role.title == 'Client'">
  <div class="row" *ngIf="courseStats">
    <div class="col-lg-8 col-sm-12">
      <div class="page-component">
        <h5 class="component-title">Overview</h5>
        <div class="card">
          <div class="card-body py-2">
            <div class="row">
              <div class="col-3">
                <div class="stat-widget">
                  <span class="stat-icon p-2">
                    <i class="material-icons">people</i>
                  </span>
                  <div class="">
                    <h4 class="stat-value fs-20px">
                      {{ courseStats.stats.allUsers }}
                    </h4>
                    <h4 class="stat-title">Users</h4>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <div class="stat-widget">
                  <span class="stat-icon p-2">
                    <i class="material-icons">recent_actors</i>
                  </span>
                  <div class="">
                    <h4 class="stat-value fs-20px">
                      {{ courseStats.stats.teams }}
                    </h4>
                    <h4 class="stat-title">Teams</h4>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <div class="stat-widget">
                  <span class="stat-icon p-2">
                    <i class="material-icons">dns</i>
                  </span>
                  <div class="">
                    <h4 class="stat-value fs-20px">
                      {{ courseStats.stats.allCourses }}
                    </h4>
                    <h4 class="stat-title">All Courses</h4>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <div class="stat-widget">
                  <span class="stat-icon p-2">
                    <i class="material-icons">assignment</i>
                  </span>
                  <div class="">
                    <h4 class="stat-value fs-20px">
                      {{ courseStats.stats.activeCourses }}
                    </h4>
                    <h4 class="stat-title">Active Courses</h4>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="page-component">
        <h5 class="component-title">Courses Enrolled</h5>
        <div class="card">
          <div class="card-body p-0">
            <div class="tasks-list-widget">
              <ng-container
                *ngIf="
                  courseStats.courses.enrolled &&
                  courseStats.courses.enrolled.length > 0
                "
              >
                <div
                  class="task-row"
                  *ngFor="let enrollment of courseStats.courses.enrolled"
                >
                  <div class="task-info">
                    <h6 class="task-title">
                      <a
                        [routerLink]="[
                          '/courses',
                          enrollment.courseAssignment.courseId
                        ]"
                        class="text-primary"
                        >{{ enrollment.courseAssignment.course.title }}</a
                      >
                    </h6>
                    <div class="task-attributes">
                      <div class="attrib">
                        <i class="material-icons">info_outline</i>
                        {{ enrollment.courseAssignment.course.code }}
                      </div>
                      <div class="attrib">
                        <i class="material-icons">bookmark_border</i>
                        {{
                          enrollment.courseAssignment.course.courseDepartment
                            .title
                        }}
                      </div>
                      <div class="attrib">
                        <i class="material-icons">access_time</i>
                        {{
                          enrollment.courseAssignment.course.approximateTime ||
                            "Not Mentioned"
                        }}
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
      <div class="page-component">
        <h5 class="component-title">Most Recent Acheivements</h5>
        <div class="card">
          <div class="card-body p-0">
            <table class="table table-bordered mb-0">
              <ng-container
                *ngIf="
                  courseStats.achievements &&
                  courseStats.achievements.length > 0
                "
              >
                <thead>
                  <tr>
                    <td class="w-25"><strong>User</strong></td>
                    <td><strong>Course</strong></td>
                    <td class="w-15 text-center"><strong>Marks</strong></td>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let achievements of courseStats.achievements">
                    <td>
                      {{
                        achievements.courseEnrollmentUser.user.firstName +
                          " " +
                          achievements.courseEnrollmentUser.user.lastName
                      }}
                    </td>
                    <td>
                      {{
                        achievements.courseEnrollmentUser.courseEnrollment
                          .courseAssignment.course.title
                      }}
                    </td>
                    <td class="text-center">{{ achievements.result }}%</td>
                  </tr>
                </tbody>
              </ng-container>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-sm-12">
      <div class="page-component">
        <h5 class="component-title">Users</h5>
        <div
          class="card card-users"
          *ngIf="courseStats.users && courseStats.users.length > 0"
        >
          <div class="card-body">
            <div class="team-row">
              <div class="users-images" *ngFor="let user of courseStats.users">
                <img [src]="ImgBaseURL + user.imageURL" />
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="page-component">
        <h5 class="component-title">Teams</h5>
        <div class="card card-users">
          <div class="card-body">
            <ng-container
              *ngIf="courseStats.teams && courseStats.teams.length > 0"
            >
              <div class="team-row" *ngFor="let team of courseStats.teams">
                <h6 class="team-title">{{ team.title }}</h6>
                <div
                  class="team-images"
                  *ngFor="let teamUser of team.teamUsers"
                >
                  <img [src]="ImgBaseURL + teamUser.user.imageURL" />
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
      <div class="page-component">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="component-title mb-0">Upcoming Course</h5>
          <span>Schedule</span>
        </div>
        <div class="card">
          <div class="card-body p-0">
            <div class="tasks-list-widget">
              <ng-container
                *ngFor="let upcomingCourse of courseStats.courses.upcoming"
              >
                <div
                  class="task-row"
                  *ngIf="
                    upcomingCourse.courseAssignments &&
                    upcomingCourse.courseAssignments.length > 0
                  "
                >
                  <div class="task-info">
                    <h6 class="task-title">
                      <a
                        [routerLink]="['/courses', upcomingCourse.id]"
                        class="text-primary"
                        >{{ upcomingCourse.title }}</a
                      >
                    </h6>
                    <div
                      class="task-attributes justify-content-between"
                      *ngFor="
                        let courseEnrollment of upcomingCourse
                          .courseAssignments[0].courseEnrollments
                      "
                    >
                      <div class="attrib">
                        <i class="material-icons">date_range</i>
                        <strong class="pr-1">Due Date: </strong>
                        {{
                          courseEnrollment.completionDateOne || "Not Mentioned"
                        }}
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>
