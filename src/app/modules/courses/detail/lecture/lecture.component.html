<div class="container page__container" *ngIf="taskDetails && taskDetails.courseTaskContent">
  <div class="row">
    <div class="col-4">
      <div class="page-separator mb-32pt">
        <div class="page-separator__text" *ngIf="syllabus.id">
          {{ syllabus.title }}
        </div>
      </div>
      <div class="row mb-0">
        <div class="col-lg-12">
          <div class="accordion js-accordion accordion--boxed list-group-flush" id="parent">
            <ng-container *ngFor="let module of modules">
              <div class="row">
                <div class="col-12">
                  <div class="accordion__item mb-4">
                    <div class="accordion__toggle collapsed">
                      <span class="flex">{{ module.title }}</span>
                    </div>
                    <div class="accordion__menu collapse show" [id]="'course-toc-' + module.id" data-parent="#parent">
                      <ng-container *ngFor="let item of module.courseTasks">
                        <div class="accordion__menu-link active" [class.bg-primary]="item.id == taskId"
                          [class.text-light]="item.id == taskId">
                          <span *ngIf="item.courseTaskType.title == 'Video'"
                            class="icon-holder icon-holder--small rounded-circle d-inline-flex icon--left"
                            [class.icon-holder--primary]="item.id == taskId"
                            [class.icon-holder--light]="item.id != taskId">
                            <i class="material-icons icon-16pt">play_circle_outline</i>
                          </span>
                          <span *ngIf="item.courseTaskType.title == 'Reading'"
                            class="icon-holder icon-holder--small rounded-circle d-inline-flex icon--left"
                            [class.icon-holder--primary]="item.id == taskId"
                            [class.icon-holder--light]="item.id != taskId">
                            <i class="material-icons icon-16pt">library_books</i>
                          </span>
                          <span *ngIf="item.courseTaskType.title == 'Assessment'"
                            class="icon-holder icon-holder--small rounded-circle d-inline-flex icon--left"
                            [class.icon-holder--primary]="item.id == taskId"
                            [class.icon-holder--light]="item.id != taskId">
                            <i class="material-icons icon-16pt">playlist_add_check</i>
                          </span>
                          <a class="flex" href="javascript:void(0)"
                            [routerLink]="['/courses', courseId ,'task', item.id]">{{ item.title
                            }}</a>
                          <span class="text-muted" *ngIf="item.id != taskId">{{ item.estimatedTime }}</span>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
    <div class="col-8">
      <div class="page-separator mb-24pt d-flex justify-content-between">
        <div class="page-separator__text">
          {{ taskDetails.title }}
        </div>
        <div class="estimatedTime d-flex align-items-center">
          <span class="icon-holder icon-holder--small rounded-circle d-inline-flex icon--left m-0">
            <i class="material-icons icon-16pt text-dark">access_time</i>
          </span>
          <span class="text-dark">{{ taskDetails.estimatedTime }}</span>
        </div>
      </div>
      <ng-container *ngIf="taskDetails.courseTaskType.title == 'Video'">
        <div id="youtube-player"></div>
        <div class="js-player embed-responsive embed-responsive-16by9 mb-48pt">
          <div class="player embed-responsive-item">
            <div class="player__content">
              <iframe src="https://www.youtube.com/embed/JGwtVbOz528?si=59O5ILV1DBmR76lO&amp;controls=0" frameborder="0"
                allow="accelerometer; autoplay; encrypted-media; gyroscope;" allowfullscreen></iframe>
            </div>
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="taskDetails.courseTaskType.title == 'Reading'">
        <div class="pdf-container">
          <pdf-viewer [src]="ImgBaseURL + taskDetails.courseTaskContent.handoutLink" [original-size]="false"
            [show-all]="true" [fit-to-page]="false" [zoom]="1" [zoom-scale]="'page-width'" [stick-to-page]="false"
            [render-text]="true" [external-link-target]="'blank'" [autoresize]="true" style="
              width: 100%;
              height: 600px;
              border: 1px solid #edf0f2;
              box-shadow: inset 0 1px 1px rgba(39, 44, 51, 0.075);
            "></pdf-viewer>
        </div>
      </ng-container>
      <ng-container *ngIf="taskDetails.courseTaskType.title == 'Assessment'">
        <div class="assessment-container">
          <h5 *ngIf="assessments.length == 0">Assessment
            <span class="heading-icon" data-toggle="modal" data-target="#assessmentModal"
              (click)="setAssessmentFormType('create')" *ngIf="permission.assessment.create">
              <i class="material-icons">add_circle</i>
            </span>
          </h5>
          <div class="card" *ngFor="let assessment of assessments">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div class="assessment">
                  <div class="d-flex justify-content-between">
                    <h5>{{ assessment.title }}</h5>
                    <div class="buttons">
                      <span data-toggle="modal" data-target="#assessmentModal" *ngIf="permission.assessment.update"
                        (click)="setAssessment(assessment); setAssessmentFormType('update')">
                        <i class="material-icons fa-lg fs-14pt mx-1">edit</i></span>
                      <span data-toggle="modal" data-target="#assessmentModal" *ngIf="permission.assessment.delete"
                        (click)="setAssessment(assessment); setAssessmentFormType('delete')">
                        <i class="material-icons fa-lg fs-14pt">delete</i></span>
                    </div>
                  </div>
                  <p>{{ assessment.description }}</p>
                  <hr class="mb-4">
                </div>
              </div>
              <ng-container *ngIf="loggedInUser.role.title == 'Administrator' || loggedInUser.role.title == 'Client'">
                <div class="assessment-questions"
                  *ngFor="let question of assessment.courseTaskAssessmentQuestions; let i = index">
                  <div class="d-flex justify-content-between">
                    <p><strong>{{ i+1 }}. {{ question.title }}</strong></p>
                    <div class="buttons">
                      <span data-toggle="modal" data-target="#assessmentQuestionModal"
                        *ngIf="permission.question.update"
                        (click)="setAssessmentQuestion(question); setAssessmentQuestionFormType('update')">
                        <i class="material-icons fa-lg fs-14pt mx-1">edit</i></span>
                      <span data-toggle="modal" data-target="#assessmentQuestionModal"
                        *ngIf="permission.question.delete"
                        (click)="setAssessmentQuestion(question); setAssessmentQuestionFormType('delete')">
                        <i class="material-icons fa-lg fs-14pt">delete</i></span>
                    </div>
                  </div>
                  <ul class="pl-2" style="list-style: none;">
                    <li *ngFor="let option of question.options; let y = index">
                      <div class="form-check">
                        <input class="form-check-input" type="radio" [id]="'option-'+i+y" [value]="option">
                        <label class="form-check-label fw-400" [for]="'option-'+i+y" style="color: #303840">
                          {{ option }}</label>
                        <span *ngIf="permission.question.view.answer && option.trim() == question.answer.trim()"
                          class="badge badge-info ml-2">correct</span>
                      </div>
                    </li>
                  </ul>
                </div>
                <button type="submit" class="btn btn-outline-primary btn-sm" data-toggle="modal"
                  data-target="#assessmentQuestionModal" *ngIf="permission.question.create"
                  (click)="setAssessmentQuestionFormType('create'); setAssessment(assessment)">
                  Add Question
                </button>
                <button type="submit" class="btn btn-primary mt-2" *ngIf="permission.assessment.submit">
                  Submit
                </button>
              </ng-container>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<div class="modal" id="assessmentModal" tabindex="-1" role="dialog"
  *ngIf="permission.assessment.create || permission.assessment.update || permission.assessment.delete">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" *ngIf="assessmentFormType == 'create' && permission.assessment.create">
          Create Assessment</h5>
        <h5 class="modal-title" *ngIf="assessmentFormType == 'update' && permission.assessment.update">
          Update Assessment</h5>
        <h5 class="modal-title" *ngIf="assessmentFormType == 'delete' && permission.assessment.delete">
          Delete Assessment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeModal>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-primary">
        <form #formTask="ngForm">
          <div class="row">
            <div class="col-12">
              <div class="form-group">
                <label for="assessmentTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="assessmentTitle" name="assessmentTitle"
                  [(ngModel)]="assessment.title" />
              </div>
            </div>
            <div class="col-12">
              <div class="form-group">
                <label for="assessmentDescription" class="form-label">Description</label>
                <textarea class="form-control" id="assessmentDescription" name="assessmentDescription"
                  [(ngModel)]="assessment.description"></textarea>
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label for="assessmentEstimatedTime" class="form-label">Estimated Time</label>
                <input type="text" class="form-control" id="assessmentEstimatedTime" name="assessmentEstimatedTime"
                  [(ngModel)]="assessment.estimatedTime" />
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label for="assessmentStartTime" class="form-label">Start Time</label>
                <input type="text" class="form-control" id="assessmentStartTime" name="assessmentStartTime"
                  [(ngModel)]="assessment.startTime" />
              </div>
            </div>

            <div class="col-12">
              <div class="buttons">
                <button class="btn btn-primary" (click)="createAssessment()"
                  *ngIf="assessmentFormType == 'create' && permission.assessment.create">Create
                </button>
                <button class="btn btn-primary" (click)="updateAssessment()"
                  *ngIf="assessmentFormType == 'update' && permission.assessment.update">Update
                </button>
                <button class="btn btn-danger" (click)="deleteAssessment()"
                  *ngIf="assessmentFormType == 'delete' && permission.assessment.delete">Delete
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="assessmentQuestionModal" tabindex="-1" role="dialog" aria-hidden="true" *ngIf="
    permission.question.create ||
    permission.question.update ||
    permission.question.delete
  ">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" *ngIf="questionFormType == 'create' && permission.question.create">
          Create Assessment Question</h5>
        <h5 class="modal-title" *ngIf="questionFormType == 'update' && permission.question.update">
          Update Assessment Question</h5>
        <h5 class="modal-title" *ngIf="questionFormType == 'delete' && permission.question.delete">
          Delete Assessment Question</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #questionModalBtnClose>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-primary">
        <form #formTask="ngForm">
          <div class="row">
            <div class="col-12">
              <div class="form-group">
                <label for="assessmentQuestionTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="assessmentQuestionTitle" name="assessmentQuestionTitle"
                  [(ngModel)]="question.title" />
              </div>
            </div>
            <div class="col-12">
              <div class="form-group">
                <label for="assessmentQuestionOptions" class="form-label">Options</label>
                <textarea class="form-control" id="assessmentQuestionOptions" name="assessmentQuestionOptions"
                  [(ngModel)]="question.options">{{ question.options }}</textarea>
              </div>
            </div>
            <div class="col-12">
              <div class="form-group">
                <label for="assessmentQuestionAnswer" class="form-label">Answer</label>
                <input type="text" class="form-control" id="assessmentQuestionAnswer" name="assessmentQuestionAnswer"
                  [(ngModel)]="question.answer" />
              </div>
            </div>
            <div class="col-12">
              <div class="buttons">
                <button class="btn btn-primary" (click)="createAssessmentQuestion()"
                  *ngIf="questionFormType == 'create' && permission.question.create">
                  Create
                </button>
                <button class="btn btn-primary" (click)="updateAssessmentQuestion()"
                  *ngIf="questionFormType == 'update' && permission.question.update">
                  Update
                </button>
                <button class="btn btn-danger" (click)="deleteAssessmentQuestion()"
                  *ngIf="questionFormType == 'delete' && permission.question.delete">
                  Delete
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<button #questionModalBtn data-toggle="modal" data-target="#questionModal" style="display: none"></button>