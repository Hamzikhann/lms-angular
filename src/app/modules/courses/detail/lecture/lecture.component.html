<div
  class="container page__container"
  *ngIf="taskDetails && taskDetails.courseTaskContent"
>
  <div class="row">
    <div class="col-lg-4 col-sm-12">
      <div class="page-separator mb-32pt">
        <div class="page-separator__text" *ngIf="syllabus.id">
          {{ syllabus.title }}
        </div>
      </div>
      <div
        class="accordion js-accordion accordion--boxed list-group-flush"
        id="parent"
      >
        <ng-container *ngFor="let module of modules">
          <div class="row">
            <div class="col-12">
              <div class="accordion__item mb-4">
                <div class="accordion__toggle collapsed">
                  <span class="flex">{{ module.title }}</span>
                </div>
                <div
                  class="accordion__menu collapse show"
                  [id]="'course-toc-' + module.id"
                  data-parent="#parent"
                >
                  <ng-container *ngFor="let item of module.courseTasks">
                    <div
                      class="accordion__menu-link"
                      [class.active]="!item.disabled"
                      [class.current]="item.id == taskId"
                    >
                      <span
                        class="icon-holder icon-holder--mini rounded-circle d-inline-flex icon--left"
                        [class.text-muted]="item.disabled"
                        [class.icon-holder--light]="item.progress == '0'"
                        [class.icon-holder--success]="item.progress != '0'"
                      >
                        <ng-container *ngIf="item.progress != '0'">
                          <i class="material-icons icon-12pt">check</i>
                        </ng-container>
                        <ng-container *ngIf="item.progress == '0'">
                          <i class="material-icons icon-14pt">
                            <ng-container
                              *ngIf="item.disabled && item.id != taskId"
                              >lock</ng-container
                            >
                            <ng-container *ngIf="!item.disabled">
                              <ng-container
                                *ngIf="
                                  item.courseTaskType.title == 'Assessment'
                                "
                                >storage</ng-container
                              >
                              <ng-container
                                *ngIf="item.courseTaskType.title == 'Reading'"
                                >description</ng-container
                              >
                              <ng-container
                                *ngIf="item.courseTaskType.title == 'Video'"
                                >play_arrow</ng-container
                              >
                            </ng-container>
                          </i>
                        </ng-container>
                      </span>
                      <a
                        class="flex"
                        [class.disabled]="item.id != taskId && item.disabled"
                        [class.text-muted]="item.id != taskId && item.disabled"
                        [routerLink]="
                          !item.disabled
                            ? ['/courses', courseId, 'task', item.id]
                            : []
                        "
                      >
                        <strong>{{ item.courseTaskType.title }}:</strong>
                        {{ item.title }} <br />
                        <div
                          class="d-flex align-items-center justify-content-between"
                        >
                          <span class="text-muted"
                            >{{ item.estimatedTime }}
                          </span>
                          <!-- <span class="text-muted" *ngIf="item.courseTaskType.title == 'Assessment' && loggedInUser.role.title == 'User'">
                            Result: {{ item.progress }}%
                          </span> -->
                        </div>
                      </a>
                    </div>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
    <div class="col-lg-8 col-sm-12">
      <div class="page-separator mb-32pt">
        <div class="page-separator__text">
          {{ taskDetails.title }}
        </div>
      </div>
      <div class="page-task">
        <ng-container *ngIf="loading">
          <div class="text-center loading-icon">
            <img src="/assets/images/loading.svg" />
          </div>
        </ng-container>
        <ng-container *ngIf="!loading">
          <div class="card mb-0">
            <div class="card-header">
              <div class="page-attributes">
                <div
                  class="estimatedTime d-flex align-items-center justify-content-between"
                >
                  <div class="d-flex align-items-center">
                    <div class="task-attribute mr-4">
                      <span
                        class="icon-holder icon-holder--mini rounded-circle d-inline-flex icon--left"
                      >
                        <i class="material-icons icon-14pt text-dark"
                          >folder_open</i
                        >
                      </span>
                      <span class="text-dark"
                        ><strong>{{
                          taskDetails.courseTaskType.title
                        }}</strong></span
                      >
                    </div>
                    <div class="task-attribute mr-4">
                      <span
                        class="icon-holder icon-holder--mini rounded-circle d-inline-flex icon--left"
                      >
                        <i class="material-icons icon-14pt text-dark"
                          >access_time</i
                        >
                      </span>
                      <span class="text-dark"
                        ><strong>{{ taskDetails.estimatedTime }}</strong></span
                      >
                    </div>
                  </div>
                  <div *ngIf="loggedInUser.role.title == 'User'">
                    <ng-container *ngIf="taskDetails.progress == '0'">
                      <div class="task-attribute">
                        <span
                          class="icon-holder icon-holder--mini rounded-circle d-inline-flex icon--left"
                        >
                          <i class="material-icons icon-14pt text-dark"
                            >info_outline</i
                          >
                        </span>
                        <span class="text-dark"
                          ><strong>Inprogress</strong></span
                        >
                      </div>
                    </ng-container>
                    <ng-container *ngIf="taskDetails.progress != '0'">
                      <div class="d-flex align-items-center">
                        <div class="task-attribute">
                          <span
                            class="icon-holder icon-holder--success icon-holder--mini rounded-circle d-inline-flex icon--left"
                          >
                            <i class="material-icons icon-14pt text-light"
                              >info_outline</i
                            >
                          </span>
                          <span class="text-dark"
                            ><strong>Completed</strong></span
                          >
                        </div>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <ng-container *ngIf="taskDetails.courseTaskType.title == 'Video'">
            <div class="card card-brt-0">
              <div class="card-body">
                <div class="video">
                  <video
                    #videoPlayer
                    controls
                    (timeupdate)="checkPauseTime()"
                    style="width: 100%"
                  >
                    <source
                      [src]="
                        VideoBaseURL + taskDetails.courseTaskContent.videoLink
                      "
                      type="video/mp4"
                    />
                  </video>
                </div>
                <button
                  data-target="#videoAssessmentModal"
                  data-toggle="modal"
                  #taskAssessmentModal
                  style="visibility: hidden; height: 0"
                >
                  Show assessment
                </button>
                <div
                  class="modal"
                  id="videoAssessmentModal"
                  tabindex="-1"
                  role="dialog"
                  data-backdrop="static"
                  data-keyboard="false"
                >
                  <div
                    class="modal-dialog modal-dialog-centered"
                    role="document"
                  >
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title">Assessment</h5>
                        <span
                          data-dismiss="modal"
                          #closeVideoAssessmentModal
                          style="visibility: hidden"
                        >
                          Close assessment
                        </span>
                      </div>
                      <div class="modal-body">
                        <div class="assessment-container">
                          <div *ngFor="let assessment of assessments">
                            <div class="assessment">
                              <div class="d-flex justify-content-between">
                                <h5>{{ assessment.title }}</h5>
                              </div>
                              <p>{{ assessment.description }}</p>
                              <hr class="mb-4" />
                            </div>
                            <ng-container>
                              <div
                                class="assessment-questions"
                                *ngFor="
                                  let question of assessment.courseTaskAssessmentQuestions;
                                  let i = index
                                "
                              >
                                <div class="d-flex justify-content-between">
                                  <p>
                                    <strong
                                      >{{ i + 1 }}. {{ question.title }}</strong
                                    >
                                  </p>
                                </div>
                                <ul class="pl-2" style="list-style: none">
                                  <li
                                    *ngFor="
                                      let option of question.options;
                                      let y = index
                                    "
                                  >
                                    <div class="form-check">
                                      <input
                                        class="form-check-input"
                                        type="radio"
                                        [name]="question.id"
                                        [id]="'option-' + i + y"
                                        [value]="option"
                                        [disabled]="submitted"
                                        (change)="
                                          getSubmissions($event, question.id)
                                        "
                                      />
                                      <label
                                        class="form-check-label fw-400"
                                        [for]="'option-' + i + y"
                                        style="color: #303840"
                                      >
                                        {{ option }}</label
                                      >
                                    </div>
                                  </li>
                                </ul>
                                <ng-container *ngFor="let data of submission">
                                  <div
                                    *ngIf="
                                      showError &&
                                      !(
                                        data.id == question.id &&
                                        data.answer.trim() ==
                                          question.answer.trim()
                                      )
                                    "
                                  >
                                    <div
                                      class="badge badge-danger mb-4 ml-2"
                                      *ngIf="data.id == question.id"
                                    >
                                      Incorrect Answer
                                    </div>
                                  </div>
                                </ng-container>
                              </div>
                              <button
                                *ngIf="!showError"
                                type="submit"
                                class="btn btn-primary mt-2 mr-2"
                                (click)="validateVideoAssessmentAnswer()"
                              >
                                Submit
                              </button>
                              <button
                                *ngIf="showError"
                                type="submit"
                                class="btn btn-outline-primary mt-2"
                                (click)="retryVideoAssessment()"
                              >
                                Retry
                              </button>
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <ng-container
            *ngIf="
              taskDetails.courseTaskType.title == 'Assessment' ||
              (taskDetails.courseTaskType.title == 'Video' &&
                loggedInUser.role.title == 'Administrator')
            "
          >
          </ng-container>

          <ng-container
            *ngIf="
              taskDetails.courseTaskType.title != 'Reading' &&
              taskDetails.courseTaskContent.description.trim() != ''
            "
          >
            <div class="page-separator__text my-2">Description</div>
            <p [innerHTML]="taskDetails.courseTaskContent.description"></p>
          </ng-container>
        </ng-container>
      </div>
      <!-- <div class="page-navigation">
        <div class="btn btn-outline-dark" *ngIf="taskIdPrevious"
          [routerLink]="['/courses', courseId, 'task', taskIdPrevious]">
          Previous Task
        </div>
        <div class="btn btn-outline-dark" *ngIf="taskIdNext && taskDetails.progress == '100'"
          [routerLink]="['/courses', courseId, 'task', taskIdNext]">
          Next Task
        </div>
      </div> -->
    </div>
  </div>
</div>

<button
  #questionModalBtn
  data-toggle="modal"
  data-target="#questionModal"
  style="display: none"
></button>
