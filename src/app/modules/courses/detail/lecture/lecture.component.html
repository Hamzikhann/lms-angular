<div class="container page__container" *ngIf="taskDetails && taskDetails.courseTaskContent">
  <div class="row">
    <div class="col-4">
      <div class="page-separator mb-32pt">
        <div class="page-separator__text" *ngIf="syllabus.id">
          {{ syllabus.title }}
        </div>
      </div>
      <div class="row mb-0">
        <div class="col-lg-12">
          <div class="accordion js-accordion accordion--boxed list-group-flush" id="parent">
            <ng-container *ngFor="let module of modules">
              <div class="row">
                <div class="col-12">
                  <div class="accordion__item mb-4">
                    <div class="accordion__toggle collapsed">
                      <span class="flex">{{ module.title }}</span>
                    </div>
                    <div class="accordion__menu collapse show" [id]="'course-toc-' + module.id" data-parent="#parent">
                      <ng-container *ngFor="let item of module.courseTasks">
                        <div class="accordion__menu-link" [class.active]="item.id == taskId"
                          [class.bg-primary]="item.id == taskId" [class.text-light]="item.id == taskId">
                          <span *ngIf="item.courseTaskType.title == 'Video'"
                            class="icon-holder icon-holder--small rounded-circle d-inline-flex icon--left"
                            [class.icon-holder--primary]="item.id == taskId"
                            [class.icon-holder--light]="item.id != taskId">
                            <i class="material-icons icon-16pt">play_circle_outline</i>
                          </span>
                          <span *ngIf="item.courseTaskType.title == 'Reading'"
                            class="icon-holder icon-holder--small rounded-circle d-inline-flex icon--left"
                            [class.icon-holder--primary]="item.id == taskId"
                            [class.icon-holder--light]="item.id != taskId">
                            <i class="material-icons icon-16pt">library_books</i>
                          </span>
                          <span *ngIf="item.courseTaskType.title == 'Assessment'"
                            class="icon-holder icon-holder--small rounded-circle d-inline-flex icon--left"
                            [class.icon-holder--primary]="item.id == taskId"
                            [class.icon-holder--light]="item.id != taskId">
                            <i class="material-icons icon-16pt">playlist_add_check</i>
                          </span>
                          <a class="flex" href="javascript:void(0)"
                            [routerLink]="['/courses', courseId ,'task', item.id]">{{ item.title
                            }}</a>
                          <span class="text-muted" *ngIf="item.id != taskId">{{ item.estimatedTime }}</span>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
    <div class="col-8">
      <div class="page-separator mb-32pt d-flex justify-content-between">
        <div class="page-separator__text">
          {{ taskDetails.title }}
        </div>
        <div class="estimatedTime d-flex align-items-center">
          <span class="icon-holder icon-holder--small rounded-circle d-inline-flex icon--left m-0">
            <i class="material-icons icon-16pt text-dark">access_time</i>
          </span>
          <span class="text-dark">{{ taskDetails.estimatedTime }}</span>
        </div>
      </div>

      <div id="youtube-player"></div>

      <!-- <div
        *ngIf="sections.videos"
        class="js-player embed-responsive embed-responsive-16by9 mb-48pt"
      >
        <div class="player embed-responsive-item">
          <div class="player__content"> -->
      <!-- <iframe

              src="https://www.youtube.com/embed/JGwtVbOz528?si=59O5ILV1DBmR76lO&amp;controls=0"
              frameborder="0"
              allow="accelerometer; autoplay; encrypted-media; gyroscope;"
              allowfullscreen
            ></iframe> -->

      <!-- </div>
        </div>
      </div> -->
    </div>
  </div>

  <div class="row">
    <h5>Assessments</h5>
    <span class="heading-icon" data-toggle="modal" data-target="#assessmentModal" (click)="setAssessmentType('create')"
      *ngIf="permission.module.create">
      <i class="material-icons">add_circle</i>
    </span>
  </div>
  <div class="row">
    <div class="col">
      <div class="card" *ngFor="let assessment of assessments">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="assessments">
              <h6>{{ assessment.title }}</h6>
              <p>{{ assessment.description }}</p>
            </div>

            <div class="buttons ml-3">
              <span data-toggle="modal" data-target="#assessmentModal" (click)="
                  setAssessment(assessment); setAssessmentType('update')
                " *ngIf="permission.assessment.update">
                <i class="material-icons fa-lg mx-1">edit</i></span>
              <span data-toggle="modal" data-target="#assessmentModal" (click)="
                  setAssessment(assessment); setAssessmentType('delete')
                " *ngIf="permission.assessment.delete">
                <i class="material-icons fa-lg mr-2">delete</i></span>
              <button type="submit" class="btn btn-outline-primary btn-sm" data-toggle="modal"
                data-target="#assessmentQuestionModal" (click)="
                  setAssessmentQuestionType('create');
                  setAssessment(assessment)
                " *ngIf="permission.question.create">
                Add Question
              </button>
            </div>
          </div>
          <div class="questions" *ngFor="let question of assessment.courseTaskAssessmentQuestions">
            <h5>{{ question.title }}</h5>
            <p>{{ question.options }}</p>
            <p>{{ question.answer }}</p>

            <div class="buttons ml-3">
              <span data-toggle="modal" data-target="#assessmentQuestionModal" (click)="
                  setAssessmentQuestion(question);
                  setAssessmentQuestionType('update')
                " *ngIf="permission.question.update">
                <i class="material-icons fa-lg mx-1">edit</i></span>
              <span data-toggle="modal" data-target="#assessmentQuestionModal" (click)="
                  setAssessmentQuestion(question);
                  setAssessmentQuestionType('delete')
                " *ngIf="permission.question.delete">
                <i class="material-icons fa-lg mr-2">delete</i></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="sections.handouts" class="mb-48pt">
    <div class="pdf-container">
      <pdf-viewer [src]="'/assets/files/lecture-43.pdf'" [original-size]="false" [show-all]="true" [fit-to-page]="false"
        [zoom]="1" [zoom-scale]="'page-width'" [stick-to-page]="false" [render-text]="true"
        [external-link-target]="'blank'" [autoresize]="true" style="
          width: 100%;
          height: 600px;
          border: 1px solid #edf0f2;
          box-shadow: inset 0 1px 1px rgba(39, 44, 51, 0.075);
        "></pdf-viewer>
    </div>
  </div>

  <div *ngIf="sections.presentations" class="mb-48pt">
    <a href="javascript:void(0)" class="btn btn-outline-primary">Download</a>
  </div>
</div>

<div class="modal" id="assessmentModal" tabindex="-1" role="dialog" aria-labelledby="assessmentModalLabel"
  aria-hidden="true" *ngIf="
    permission.assessment.create ||
    permission.assessment.update ||
    permission.assessment.delete
  ">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="assessmentModalLabel"
          *ngIf="assessmentType == 'create' && permission.assessment.create">
          Create Assessment
        </h5>
        <h5 class="modal-title" id="assessmentModalLabel"
          *ngIf="assessmentType == 'update' && permission.assessment.update">
          Update Assessment
        </h5>
        <h5 class="modal-title" id="assessmentModalLabel"
          *ngIf="assessmentType == 'delete' && permission.assessment.delete">
          Delete Assessment
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeModal>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-primary">
        <form #formTask="ngForm">
          <div class="row">
            <div class="col-12">
              <div class="form-group">
                <label for="assessmentTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="assessmentTitle" name="assessmentTitle"
                  [(ngModel)]="assessment.title" />
              </div>
            </div>
            <div class="col-12">
              <div class="form-group">
                <label for="assessmentDescription" class="form-label">Description</label>
                <textarea class="form-control" id="assessmentDescription" name="assessmentDescription"
                  [(ngModel)]="assessment.description"></textarea>
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label for="assessmentEstimatedTime" class="form-label">Estimated Time</label>
                <input type="text" class="form-control" id="assessmentEstimatedTime" name="assessmentEstimatedTime"
                  [(ngModel)]="assessment.estimatedTime" />
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label for="assessmentEstimatedTime" class="form-label">Start Time</label>
                <input type="text" class="form-control" id="assessmentEstimatedTime" name="assessmentEstimatedTime"
                  [(ngModel)]="assessment.startTime" />
              </div>
            </div>

            <div class="col-12">
              <div class="buttons">
                <button class="btn btn-primary" (click)="createAssessment()" *ngIf="
                    assessmentType == 'create' && permission.assessment.create
                  ">
                  Create
                </button>
                <button class="btn btn-primary" (click)="updateAssessment()" *ngIf="
                    assessmentType == 'update' && permission.assessment.update
                  ">
                  Update
                </button>
                <button class="btn btn-danger" (click)="deleteAssessment()" *ngIf="
                    assessmentType == 'delete' && permission.assessment.delete
                  ">
                  Delete
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="assessmentQuestionModal" tabindex="-1" role="dialog"
  aria-labelledby="assessmentQuestionModalLabel" aria-hidden="true" *ngIf="
    permission.question.create ||
    permission.question.update ||
    permission.question.delete
  ">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="assessmentQuestionModalLabel" *ngIf="
            assessmentQuestionType == 'create' && permission.question.create
          ">
          Create Assessment Question
        </h5>
        <h5 class="modal-title" id="assessmentQuestionModalLabel" *ngIf="
            assessmentQuestionType == 'update' && permission.question.update
          ">
          Update Assessment Question
        </h5>
        <h5 class="modal-title" id="assessmentQuestionModalLabel" *ngIf="
            assessmentQuestionType == 'delete' && permission.question.delete
          ">
          Delete Assessment Question
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeModal>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-primary">
        <form #formTask="ngForm">
          <div class="row">
            <div class="col-12">
              <div class="form-group">
                <label for="assessmentQuestionTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="assessmentQuestionTitle" name="assessmentQuestionTitle"
                  [(ngModel)]="question.title" />
              </div>
            </div>
            <div class="col-12">
              <div class="form-group">
                <label for="assessmentQuestionOptions" class="form-label">Options</label>
                <input type="text" class="form-control" id="assessmentQuestionOptions" name="assessmentQuestionOptions"
                  [(ngModel)]="question.options" />
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label for="assessmentQuestionAnswer" class="form-label">Answer</label>
                <input type="text" class="form-control" id="assessmentQuestionAnswer" name="assessmentQuestionAnswer"
                  [(ngModel)]="question.answer" />
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label for="assessmentQuestionType" class="form-label">Type</label>
                <input type="text" class="form-control" id="assessmentQuestionType" name="assessmentQuestionType"
                  [(ngModel)]="question.type" />
              </div>
            </div>

            <div class="col-12">
              <div class="buttons">
                <button class="btn btn-primary" (click)="createAssessmentQuestion()" *ngIf="
                    assessmentQuestionType == 'create' &&
                    permission.question.create
                  ">
                  Create
                </button>
                <button class="btn btn-primary" (click)="updateAssessmentQuestion()" *ngIf="
                    assessmentQuestionType == 'update' &&
                    permission.question.update
                  ">
                  Update
                </button>
                <button class="btn btn-danger" (click)="deleteAssessmentQuestion()" *ngIf="
                    assessmentQuestionType == 'delete' &&
                    permission.question.delete
                  ">
                  Delete
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<button #questionModalBtn data-toggle="modal" data-target="#questionModal" style="display: none">
  ds
</button>

<div class="modal fade" id="questionModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button class="d-none" data-dismiss="modal" aria-label="Close" #questionModalBtnClose>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="quiz-container">
          <p>What is 2 + 2?</p>
          <label *ngFor="let option of options">
            <input type="radio" name="quizOption" [value]="option.value" [(ngModel)]="selectedOption" />
            {{ option.label }}
          </label>
        </div>
        <div class="retry-container" *ngIf="showError">
          <p class="text-danger">Incorrect answer!</p>
          <p>Please retry the quiz.</p>
          <button (click)="retryQuiz()">Retry</button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="checkAnswer()">
          Submit
        </button>
      </div>
    </div>
  </div>
</div>